---
import Layout from "../layouts/Layout.astro";
---

<Layout title="Musiclapse">
	<main class="h-screen flex flex-col justify-center items-center">
		<div class="container">
			<article class="flex items-center">
				<div class="glows"></div>

				<span class="header">
					<img src="/src/assets/images/ml-logo.svg" /></span
				>

				<h1 class="text-6xl mt-5 uppercase font-bold">Musiclapse</h1>
				<h5 class="text-2x: { x: number; y: number; }l">
					Next level of music
				</h5>
				<a
					href="https://www.youtube.com/@musiclapse"
					class="flex flex-row items-center transition ease-in-out delay-150 hover:-translate-y-1 hover:scale-80 border-2 border-transparent duration-150 mt-8 px-6 py-2 hover:border-2 hover:text-white hover:border-white rounded-full shadow-sm"
					>Visit Youtube
					<svg
						class="ml-1"
						width="24"
						height="24"
						viewBox="0 0 24 24"
						stroke-width="2"
						stroke="currentColor"
						fill="none"
						stroke-linecap="round"
						stroke-linejoin="round"
						><path stroke="none" d="M0 0h24v24H0z" fill="none"
						></path><path d="M17 7l-10 10"></path><path
							d="M8 7l9 0l0 9"></path></svg
					></a
				>
			</article>
		</div>
	</main>
</Layout>

<script>
	const CONTAINER: HTMLElement | null = document.querySelector(".container");
	const CARDS = document.querySelectorAll("article");

	const CONFIG = {
		proximity: 40,
		spread: 80,
		blur: 20,
		gap: 32,
		vertical: false,
		opacity: 0,
	};

	const PROXIMITY = 10;

	const UPDATE = (event: PointerEvent) => {
		// get the angle based on the center point of the card and pointer position
		for (const CARD of CARDS) {
			// Check the card against the proximity and then start updating
			const CARD_BOUNDS = CARD.getBoundingClientRect();
			// Get distance between pointer and outerbounds of card
			if (
				event?.x > CARD_BOUNDS.left - CONFIG.proximity &&
				event?.x <
					CARD_BOUNDS.left + CARD_BOUNDS.width + CONFIG.proximity &&
				event?.y > CARD_BOUNDS.top - CONFIG.proximity &&
				event?.y <
					CARD_BOUNDS.top + CARD_BOUNDS.height + CONFIG.proximity
			) {
				// If within proximity set the active opacity
				CARD.style.setProperty("--active", "1");
			} else {
				CARD.style.setProperty("--active", CONFIG.opacity.toString());
			}
			const CARD_CENTER = [
				CARD_BOUNDS.left + CARD_BOUNDS.width * 0.5,
				CARD_BOUNDS.top + CARD_BOUNDS.height * 0.5,
			];
			let ANGLE =
				(Math.atan2(
					event?.y - CARD_CENTER[1],
					event?.x - CARD_CENTER[0],
				) *
					180) /
				Math.PI;
			ANGLE = ANGLE < 0 ? ANGLE + 360 : ANGLE;
			CARD.style.setProperty("--start", (ANGLE + 90).toString());
		}
	};

	document.body.addEventListener("pointermove", UPDATE);

	const RESTYLE = () => {
		if (CONTAINER) {
			CONTAINER.style.setProperty("--gap", CONFIG.gap.toString());
			CONTAINER.style.setProperty("--blur", CONFIG.blur.toString());
			CONTAINER.style.setProperty("--spread", CONFIG.spread.toString());
			CONTAINER.style.setProperty(
				"--direction",
				CONFIG.vertical ? "column" : "row",
			);
		}
	};

	RESTYLE();
	// UPDATE();
</script>

<style>
	@font-face {
		font-family: "Aber Mono";
		src: url("/src/assets/fonts/Aber-Mono-Regular.otf") format("truetype");
	}

	:root {
		--bg: hsl(246 44% 7%);
		--border: hsl(280 10% 50% / 1);
		--card: hsl(237 36% 10%);
		--color: hsl(240 18% 80%);
		--border-width: 2px;
		--border-radius: 12px;
		--gradient: conic-gradient(
			from 180deg at 50% 70%,
			hsla(0, 0%, 98%, 1) 0deg,
			#eec32d 72.0000010728836deg,
			#ec4b4b 144.0000021457672deg,
			#709ab9 216.00000858306885deg,
			#4dffbf 288.0000042915344deg,
			hsla(0, 0%, 98%, 1) 1turn
		);
	}

	*,
	*:after,
	*:before {
		box-sizing: border-box;
	}

	@property --start {
		syntax: "<number>";
		inherits: true;
		initial-value: 0;
	}

	body {
		background: var(--bg);
		display: grid;
		place-items: center;
		min-height: 100vh;
		font-family: "Geist Sans", "SF Pro Text", "SF Pro Icons", "AOS Icons",
			"Helvetica Neue", Helvetica, Arial, sans-serif, system-ui;
		font-weight: 70;
		color: var(--color);
	}

	img {
		height: 8rem;
	}

	h1 {
		font-family: "Aber Mono";
	}

	h5 {
		font-family: "Aber Mono";
	}

	a {
		font-family: "Aber Mono";
	}

	/* .container {
		--spread: 60;
		display: flex;
		flex-wrap: wrap;
		flex-direction: var(--direction);
		gap: calc(var(--gap) * 1px);
		margin: 0 auto;
		justify-content: center;
		place-items: center;
		position: relative;
		padding: 2rem;
		touch-action: none;
	} */

	article {
		--active: 0.15;
		--start: 0;
		height: 100%;
		background: var(--card);
		padding: 2rem;
		aspect-ratio: 330 / 400;
		border-radius: var(--border-radius);
		width: 40rem;
		height: 25rem;
		display: flex;
		flex-direction: column;
		gap: 0.25rem;
		position: relative;
	}

	article:is(:hover, :focus-visible) {
		z-index: 2;
	}

	.glows {
		pointer-events: none;
		position: absolute;
		inset: 0;
		filter: blur(calc(var(--blur) * 1px));
	}

	.glows::after,
	.glows::before {
		--alpha: 0;
		content: "";
		background: var(--gradient);
		background-attachment: fixed;
		position: absolute;
		inset: -5px;
		border: 10px solid transparent;
		border-radius: var(--border-radius);
		mask: linear-gradient(#0000, #0000),
			conic-gradient(
				from calc((var(--start) - (var(--spread) * 0.5)) * 1deg),
				#000 0deg,
				#fff,
				#0000 calc(var(--spread) * 1deg)
			);
		mask-composite: intersect;
		mask-clip: padding-box, border-box;
		opacity: var(--active);
		transition: opacity 1s;
	}

	article::before {
		position: absolute;
		inset: 0;
		border: var(--border-width) solid transparent;
		content: "";
		border-radius: var(--border-radius);
		pointer-events: none;
		background: var(--border);
		background-attachment: fixed;
		border-radius: var(--border-radius);
		mask: linear-gradient(#0000, #0000),
			conic-gradient(
				from
					calc(
						(
								(var(--start) + (var(--spread) * 0.25)) -
									(var(--spread) * 1.5)
							) * 1deg
					),
				hsl(0 0% 100% / 0.15) 0deg,
				white,
				hsl(0 0% 100% / 0.15) calc(var(--spread) * 2.5deg)
			);
		mask-clip: padding-box, border-box;
		mask-composite: intersect;
		opacity: var(--active);
		transition: opacity 1s;
	}

	article::after {
		--bg-size: 100%;
		content: "";
		pointer-events: none;
		position: absolute;
		background: var(--gradient);
		background-attachment: fixed;
		border-radius: var(--border-radius);
		opacity: var(--active, 0);
		transition: opacity 1s;
		--alpha: 0;
		inset: 0;
		border: var(--border-width) solid transparent;
		mask: linear-gradient(#0000, #0000),
			conic-gradient(
				from
					calc(
						(
								(var(--start) + (var(--spread) * 0.25)) -
									(var(--spread) * 0.5)
							) * 1deg
					),
				#0000 0deg,
				#fff,
				#0000 calc(var(--spread) * 0.5deg)
			);
		filter: brightness(1.5);
		mask-clip: padding-box, border-box;
		mask-composite: intersect;
	}

	.badge {
		border: 2px solid var(--border);
		align-self: start;
		border-radius: 100px;
		padding: 0.5rem 0.7rem;
		font-size: 0.675rem;
		display: flex;
		align-items: center;
		gap: 0.25rem;
		font-weight: 50;
	}

	/* a {
		color: var(--color);
		text-decoration: none;
		opacity: 0.5;
		display: inline-block;
		align-self: start;
		transition: opacity 0.2s;
	} */

	/* a:is(:hover, :focus-visible) {
		opacity: 1;
	} */

	/* article h2 {
		margin: 0;
		padding: 1rem 0;
		font-weight: 100;
		font-size: 1.5rem;
	} */

	.header {
		position: relative;
		flex: 1;
		display: flex;
		align-items: center;
	}

	.header svg {
		--count: 4;
		width: 106px;
	}

	.header svg:nth-of-type(2),
	.header svg:nth-of-type(3),
	.header svg:nth-of-type(4) {
		position: absolute;
		z-index: calc(var(--count) - var(--index));
		translate: calc(var(--index) * 30%) 0;
		opacity: calc(var(--count) / (2 * (var(--index) * 10)));
	}

	.header svg:nth-of-type(2) {
		--index: 1;
	}
	.header svg:nth-of-type(3) {
		--index: 2;
	}
	.header svg:nth-of-type(4) {
		--index: 3;
	}

	.badge svg {
		width: 16px;
	}

	.dg.ac {
		z-index: 99999 !important;
	}
</style>
